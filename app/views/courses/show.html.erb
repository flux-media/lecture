<% banner_thumbnail_url @course.thumbnail %>

<div class="courses">
  <aside><%= @course.detail %></aside>
</div>

<div class="teacher">
  <h2><%= Teacher.model_name.human %></h2>
  <% @course.teachers.each do |teacher| %>
      <p>
        <%= teacher.user.name %>: <%= teacher.description %>
      </p>
  <% end %>
</div>

<div class="course_schedule">
  <h2><%= CourseSchedule.model_name.human %></h2>
  <table class="pure-table custom-table">
    <thead>
    <tr>
      <th></th>
      <th><%= Lesson.human_attribute_name('name') %></th>
      <th><%= Teacher.model_name.human %></th>
      <th><%= LessonSchedule.human_attribute_name('held_at') %></th>
      <th><%= Location.model_name.human %></th>
    </tr>
    </thead>
    <tbody>
    <% @course.lessons.each_with_index do |lesson, index| %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= lesson.name %></td>
          <td><%= lesson.teacher.user.name %></td>
          <td>
            <% held_at = '' %>
            <% displayable_course_schedule.lesson_schedules.
                    each do |lesson_schedule| %>
                <% if lesson.id === lesson_schedule.lesson.id %>
                    <% held_at = lesson_schedule.held_at.
                            strftime(t('simple_datetime')) %>
                    <% break %>
                <% end %>
            <% end %>
            <%= held_at %>
          </td>
          <td>
            <% displayable_course_schedule.lesson_schedules.
                    each do |lesson_schedule| %>
                <% if lesson.id === lesson_schedule.lesson.id %>
                    <%= lesson_schedule.location.nil? ?
                                '' : lesson_schedule.location.name %>
                <% end %>
            <% end %>
          </td>
        </tr>
    <% end %>
    </tbody>
  </table>
</div>

<div class="registration">
  <% if is_course_open %>
      <% if registration.nil? %>
          <%= form_tag course_registrations_path(@course),
                       class: 'pure-form' do %>
              <%= submit_tag 'Register now!',
                             class: 'pure-button pure-button-primary' %>
          <% end %>
      <% else %>
          <%= form_tag course_registration_path(@course, registration),
                       class: 'pure-form', method: 'delete' do %>
              <%= submit_tag t('cancel_registration'),
                             class: 'button-warning pure-button' %>
          <% end %>
      <% end %>
  <% else %>
      <%= link_to t('courses_closed'), '#',
                  class: 'pure-button pure-button-disabled' %>
  <% end %>
</div>

<% content_for :banner do %>
    <h1 class="banner-head"><%= @course.name %></h1>
<% end %>
